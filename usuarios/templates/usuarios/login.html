{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Acesse o DocFinance para gerenciar documentos e relatórios financeiros com segurança.">
    <meta name="keywords" content="DocFinance, login, documentos, relatórios, finanças">
    <title>DocFinance - Login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="{% static 'usuarios/css/home.css' %}" rel="stylesheet">
    <style>
        :root { --brand:#007e33; --brand-dark:#006128; }
        html, body { height: 100%; }
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            font-size: 0.90rem;
        }

        /* Layout dividido: imagem à esquerda, login à direita */
        .split-layout { display: flex; flex: 1; min-height: 100vh; }
        .image-panel {
            flex: 1 1 auto;
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            position: relative;
        }
        .image-overlay { position: absolute; inset: 0; background: linear-gradient(0deg, rgba(0,0,0,0.25), rgba(0,0,0,0.25)); }

        .login-panel { flex: 0 0 460px; display: flex; flex-direction: column; align-items: flex-start; justify-content: flex-start; gap: 10px; padding: 1.9rem; background: #fff; box-shadow: -4px 0 24px rgba(0,0,0,.05); position: relative; }
        .login-card { width: 100%; max-width: 440px; border-radius: 10px; overflow: hidden; border: 1px solid #e5e7eb; }
        .card-header { background-color: var(--brand); color: white; padding: 12px; text-align: center; }
        .card-body { padding: 20px; }
        .logo-prefeitura { height: 56px; object-fit: contain; filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1)); }
        .logo-top { display: flex; align-items: flex-start; justify-content: flex-start; width: 100%; margin: 4px 0 8px; }
        .welcome-text { width: 100%; text-align: center; margin: 6px 0 12px; }
        .welcome-text .brand-title { font-size: 1rem; font-weight: 600; color: #111827; line-height: 1.2; }
        .welcome-text .brand-sub { font-size: .9rem; color: #6b7280; }
        .card-header h2 { font-size: 1.15rem; margin: 0; }
        .form-label { font-size: 0.90rem; }
        .form-control { font-size: 0.90rem; padding: 0.5rem 0.75rem; }
        .btn { font-size: 0.92rem; }
        /* Compactar espaçamento dos links auxiliares */
        .compact-links p { margin: 0.25rem 0; }

        /* Rodapé com logo e texto de boas-vindas (lado de fora do card) */
        .login-footer { position: absolute; right: 16px; bottom: 12px; display: flex; justify-content: flex-end; width: auto; }
        .login-footer .footer-content { text-align: right; color: #374151; }
        .login-footer .brand-logo { height: 44px; object-fit: contain; display: inline-block; }
        .btn-primary { background-color: var(--brand); border-color: var(--brand); }
        .btn-primary:hover { background-color: var(--brand-dark); border-color: var(--brand-dark); }
        a { color: var(--brand); }
        a:hover { color: var(--brand-dark); }

        /* Responsivo: abaixo de 992px, empilha; abaixo de 576px, foca no login */
        @media (max-width: 992px) {
            .split-layout { flex-direction: column; }
            .image-panel { height: 40vh; }
            .login-panel { flex: 0 0 auto; box-shadow: none; }
        }
        @media (max-width: 576px) {
            .image-panel { display: none; }
            .login-panel { padding: 1.25rem; }
            .card-body { padding: 18px; }
        }
    </style>
</head>
<body>
    <div class="split-layout">
        <!-- Painel de imagem rotativa -->
        <div class="image-panel" id="splashImage">
            <div class="image-overlay"></div>
        </div>
        <!-- Painel de login à direita -->
        <div class="login-panel">
            <div class="logo-top">
                <img src="{% static 'img/logo_prefeitura.png' %}" alt="Prefeitura Municipal de Moju" class="logo-prefeitura" width="200" height="56">
            </div>
            <div class="welcome-text">
                <div class="brand-title">Bem-vindo ao DocFinance</div>
                <div class="brand-sub">Sistema de gerenciamento de documentos financeiros</div>
            </div>
            <div class="login-card">
                <div class="card-header">
                    <h2>Login</h2>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {% for error in form.non_field_errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                        <div class="mb-3">
                            <label for="{{ form.username.id_for_label }}" class="form-label">Nome de usuário</label>
                            {{ form.username|add_class:"form-control" }}
                            {% if form.username.errors %}
                                <div class="text-danger">
                                    {% for error in form.username.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form.password.id_for_label }}" class="form-label">Senha</label>
                            {{ form.password|add_class:"form-control" }}
                            {% if form.password.errors %}
                                <div class="text-danger">
                                    {% for error in form.password.errors %}{{ error }}{% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Entrar</button>
                        </div>
                    </form>
                    <div class="mt-2 text-center compact-links">
                        <p>
                            Esqueceu sua senha? <a href="{% url 'password_reset' %}">Clique aqui</a> para recuperá-la.
                        </p>
                        <p>
                            Não tem uma conta? <a href="{% url 'registro' %}">Registre-se</a>
                        </p>
                        
                    </div>
                </div>
            </div>
            <div class="login-footer">
                <div class="footer-content">
                    <img class="brand-logo" src="{% static 'img/DocFinance3.png' %}" alt="DocFinance" width="160" height="44">
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Configuração automática de imagens por faixa de horário
        (function() {
            const morningImages = [
                '{% static "img/home/optimized/manha1.jpg" %}',
                '{% static "img/home/optimized/manha2.jpg" %}',
                '{% static "img/home/optimized/manha3.jpg" %}',
                '{% static "img/home/optimized/manha4.jpg" %}',
                '{% static "img/home/optimized/manha5.jpg" %}',
                '{% static "img/home/optimized/manha6.jpg" %}'
            ];
            const afternoonImages = [
                '{% static "img/home/optimized/tarde1.jpg" %}',
                '{% static "img/home/optimized/tarde2.jpg" %}',
                '{% static "img/home/optimized/tarde3.jpg" %}',
                '{% static "img/home/optimized/tarde4.jpg" %}',
                '{% static "img/home/optimized/tarde5.jpg" %}',
                '{% static "img/home/optimized/tarde6.jpg" %}'
            ];
            const eveningImage = '{% static "img/home/optimized/noite.jpg" %}';

            // Pré-carregar imagens
            [...morningImages, ...afternoonImages, eveningImage].forEach(src => { const img = new Image(); img.src = src; });

            const splash = document.getElementById('splashImage');
            let currentPhase = null;
            let rotationTimer = null;
            let checkTimer = null;
            let idx = 0;

            function getPhase(dt) {
                const h = dt.getHours();
                if (h >= 6 && h < 12) return 'morning';
                if (h >= 12 && h < 18) return 'afternoon';
                return 'evening';
            }
            function getIntervalMs(phase) {
                if (phase === 'morning') return 30 * 60 * 1000; // 30min
                if (phase === 'afternoon') return 60 * 60 * 1000; // 1h
                return null; // evening: sem rotação
            }
            function imagesFor(phase) {
                if (phase === 'morning') return morningImages;
                if (phase === 'afternoon') return afternoonImages;
                return [eveningImage];
            }
            function setBackground(src) {
                splash.style.backgroundImage = `url('${src}')`;
            }
            function applyPhase(phase, initial=false) {
                const imgs = imagesFor(phase);
                if (initial) idx = 0; else idx = (idx + 1) % imgs.length;
                setBackground(imgs[idx]);
                const interval = getIntervalMs(phase);
                if (rotationTimer) { clearInterval(rotationTimer); rotationTimer = null; }
                if (interval) {
                    rotationTimer = setInterval(() => {
                        const nowPhase = getPhase(new Date());
                        if (nowPhase !== phase) { // fase mudou
                            currentPhase = nowPhase;
                            applyPhase(currentPhase, true);
                            return;
                        }
                        const imgs2 = imagesFor(phase);
                        idx = (idx + 1) % imgs2.length;
                        setBackground(imgs2[idx]);
                    }, interval);
                }
            }
            function init() {
                currentPhase = getPhase(new Date());
                applyPhase(currentPhase, true);
                // verificação de mudança de fase a cada minuto
                checkTimer = setInterval(() => {
                    const ph = getPhase(new Date());
                    if (ph !== currentPhase) {
                        currentPhase = ph;
                        applyPhase(currentPhase, true);
                    }
                }, 60 * 1000);
            }
            init();
        })();
    </script>
</body>
</html>
